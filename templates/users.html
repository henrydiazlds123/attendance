{% extends "layout.html" %}
{% block title %}Attendance | Users{% endblock %}
{% block content %}
    <h2>Usuarios</h2>
    <a href="{{ url_for('routes.create_user') }}">Add New User</a>
        
    <table class="table table-striped table-sm pb-5">
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Username</th>
          <th scope="col">Email</th>
          <th scope="col">Role</th>
          {% if session['role'] == 'Owner' %}
          <th scope="col">Unit</th>
          {% endif %}
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
      {% for user in users %}
        <tr>
          <td scope="row">{{ loop.index }}</td>
          <td>{{user.username}}</td>
          <td>{{user.email}}</td>
          <td>{{user.role}}</td>
          {% if session['role'] == 'Owner' %}
          <td>{{user.meeting_center_id}}</td>
          {% endif %}
          <td>
            {% if not user['role'] == 'Owner' %}
              <a href="{{ url_for('routes.reset_password', id=user.id) }}" class="btn btn-warning btn-sm" data-toggle="tooltip" title="Reset Password" ><i class="fa fa-key fa-fw"></i></a>
              <a type="buton" class="btn btn-primary btn-sm" data-toggle="tooltip" title="Editar usuario" href="{{ url_for('routes.update_user', id=user.id) }}"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
              {% if user['role'] == 'User' or admin_count > 1 %}
              <form action="{{ url_for('routes.delete_user', id=user.id) }}" method="post" style="display:inline;">
                  <button type="submit" class="btn btn-danger btn-sm" data-toggle="tooltip" title="Eliminar usuario" ><i class="fa fa-trash-o fa-fw"></i></button>
              </form>
              {% endif %}
              {% if user['role'] == 'User' %}
                <form id="promoteForm-{{ user.id }}" action="{{ url_for('routes.promote_to_admin', id=user.id) }}" method="POST" style="display:inline;">
                    <button type="button" class="btn btn-success btn-sm" data-toggle="tooltip" title="Cambiar privilegios a Administrador" onclick="confirmPromotion({{ user.id }}, '{{ user.username }}')"><i class="fa fa-unlock"></i></button>
                </form>
              {% endif %}
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
        
{% endblock %}
