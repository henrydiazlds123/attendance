{% extends "layout.html" %}
{% block title %}{{ _('Attendance | Manual') }} {% endblock %}
{% block content %}
    <div class="col-md">
        <h2><i class="bi bi-card-checklist"></i>  {{ _('Attendance Registration') }}</h2>
        <div class="col-xl-8">
            <p class="mt-3">{{ _('Use this page to add the attendance to the classes listed below. You will be able to record attendance for those people who do not have the means to do so themselves.') }}</p>
            <p>{{ _('To be able register your attendance, first you will need to choose a class.') }}</p>
        </div>
        

        <h4 id="classNameDisplay" class="mb-3 text-center"></h4>

        <div class="list-group my-3">
            {% for class_data in class_links.values() %}
            <li style="list-style-type: none;">
                <a href="{{ class_data['url'] }}" class="list-group-item list-group-item-action">{{ _(class_data['name']) }}</a>
            {% endfor %}
        </div>
        <form id="attendanceForm" method="POST" action="{{ url_for('routes.registrar') }}">
            <div class="input-group mt-4">
                <input type="text" class="form-control" id="studentName" name="studentName" aria-label="{{ _('Enter your Name and Last name') }}" aria-describedby="button-addon2"  placeholder="{{ _('Name & Lastname') }}">
                <button class="btn btn-primary" type="submit" id="button-addon2"><i class="fa fa-share-square-o" aria-hidden="true"></i> {{ _('Send') }}</button>               
            </div>
            <input type="hidden" id="className" name="className">
            <input type="hidden" id="date" name="date">
            <input type="hidden" id="classCode" name="classCode">
            <input type="hidden" id="sundayCode" name="sundayCode">
            <input type="hidden" id="unitNumber" name="unitNumber">
        </form>
        <script>
            // ----------- Configuración de parámetros de clase desde URL ----------- 
            const urlParams  = new URLSearchParams(window.location.search);
            const className  = urlParams.get("class_name");
            const classCode  = urlParams.get("class");
            const sundayCode = urlParams.get("code");
            const unitNumber = urlParams.get("unit");
            
            if (className) {
                document.getElementById("classNameDisplay").textContent =  className;
                document.getElementById("className").value = decodeURIComponent(className);
                document.getElementById("classCode").value = classCode;
                document.getElementById("sundayCode").value = sundayCode;
                document.getElementById("unitNumber").value = unitNumber;
            
                const listGroupItems = document.querySelectorAll('.list-group-item');
                listGroupItems.forEach(item => {
                    if (item.textContent.trim() === decodedClassName) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active'); // Asegurarse de que los demás elementos no estén activos
                    }
                });             
            } else {            
                document.getElementById("classNameDisplay").textContent = 'Choose a Class';
                document.getElementById("button-addon2").disabled = true;
                document.getElementById("studentName").disabled = true;
            }         
            // ----------- Establecer la fecha actual -----------
            document.getElementById("date").value = new Date().toISOString().split("T")[0]; 
        </script>
    </div>
{% endblock %}