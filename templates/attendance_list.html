{% extends "layout.html" %}
{% block title %}{{ _('Attendance | List') }}{% endblock %}

{% block head %}
<script>

  // Función para enviar el formulario al cambiar el valor de un select
  function submitForm() {
    document.getElementById('filterForm').submit();
  }
  function clearFilters() {
    //document.getElementById("filterForm").reset();
    //document.getElementById("filterForm").submit();
    // Eliminar todos los parámetros de la URL (filtros)
    window.location.href = "{{ url_for('routes.attendances') }}";
}

</script>

{% endblock %}

{% block pageTitle %}<i class="bi bi-clipboard-data"></i> {{ _('Attendance Records Management') }}{% endblock %}
{% block content %}
<div class="blog-post">
  <div class="col-xl-8">
    <p class="mb-3">
      {{ _("The table shows the attendance recorded each Sunday by members attending classes. Use the information in this list to Record each person's Attendance in the Tools application or <a href='https://lcr.churchofjesuschrist.org/report/class-and-quorum-attendance/overview?lang=spa'>LCR</a>.") | safe }}
    </p>
  </div>
  {% if session['role'] == 'Owner' %}

  {% endif %}
  {% if session['role'] == 'Admin' or session['role'] == 'Owner' %}

    <div class="col-auto mb-2">
      <a class="btn btn-primary col-auto" href="{{ url_for('routes.create_attendance') }}"><i class="bi bi-plus-circle-fill"></i> {{ _('New Attendance') }}</a>
    </div>

  {% endif %}
  <div class="mb-5">
    
    <form id="filterForm" method="GET" action="/attendance/list" class="card mb-3 p-3">

      {% include 'partials/form_filter.html' %}
    </form>
    <!-- Actions Form -->
    <form method="POST" action="/attendance/list" class="pb-2">
      <!-- Agregar un menú desplegable para seleccionar el número de elementos por página -->
    <label for="per_page">Records per page</label>
    <!-- <select id="per_page_select" name="per_page">
      <option value="25">25</option>
      <option value="50">50</option>
      <option value="100">100</option>
      <option value="300">300</option>
    </select> -->
    <select id="per_page_select" name="per_page">
      <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
      <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
      <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
      <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
      <option value="150" {% if per_page == 150 %}selected{% endif %}>150</option>
    </select>
    
    {% include 'partials/attendance_list_table.html' %}
      <!-- Agregar la paginación -->
      <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if pagination.has_prev %}
                <li class="page-item"><a class="page-link" href="{{ url_for('routes.attendances', page=pagination.prev_num, per_page=pagination.per_page, class_name=request.args.get('class_name'), student_name=request.args.get('student_name'), sunday_date=request.args.get('sunday_date')) }}">Previous</a>
                </li>
            {% endif %}
            {% for page_num in pagination.iter_pages() %}
                {% if page_num %}
                    <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('routes.attendances', page=page_num, per_page=pagination.per_page, class_name=request.args.get('class_name'), student_name=request.args.get('student_name'), sunday_date=request.args.get('sunday_date')) }}">{{ page_num }}</a>
                    </li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">…</span></li>
                {% endif %}
            {% endfor %}
            {% if pagination.has_next %}
                <li class="page-item"><a class="page-link" href="{{ url_for('routes.attendances', page=pagination.next_num, per_page=pagination.per_page, class_name=request.args.get('class_name'), student_name=request.args.get('student_name'), sunday_date=request.args.get('sunday_date')) }}">Next</a></li>
            {% endif %}
        </ul>
      </nav>
    </form>
    {% if session['role'] == 'Owner' %}
    <form id="deleteAllForm" method="POST" action="/attendances" class="mb-5">
      <input type="hidden" name="delete_all" value="true">
      <button id="delete_all" class="btn btn-danger mb-5" type="button" data-toggle="tooltip"
        title="{{ _('Delete all attendance records in the database') }}" {% if not has_records %}disabled{% endif %}>
        {% if not has_records %}
        {{ _('No Attendances to show') }}
        {% else %}
        <i class="bi bi-eraser-fill"></i> {{ _('Delete all records') }}
        {% endif %}
      </button>
    </form>
    <!-- Script para manejar la selección de elementos por página -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const perPageSelect = document.getElementById('per_page_select');
        const filterForm = document.getElementById('filterForm');
    
        // Restaurar selección previa desde localStorage
        const savedPerPage = localStorage.getItem('per_page');
        if (savedPerPage) {
            perPageSelect.value = savedPerPage;
        }
    
        // Cuando el usuario cambia el número de registros por página
        perPageSelect.addEventListener('change', function() {
            localStorage.setItem('per_page', this.value);
            
            // Agregar el valor al formulario y enviarlo
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('per_page', this.value);
            window.location.search = urlParams.toString();
        });
      });
    </script>
    
    
    {% endif %}

     {% endblock %}