{% extends "layout.html" %}
{% block title %}{{ _('Attendance | PDFs') }}{% endblock %}
{% block content %}
    <h2><i class="bi bi-qr-code"></i>  {{ _('QR Code Generation') }}</h2>
    <p>{{ _('On this page, you can generate and download for printing, the sheets with the QR Code images that the member can scan to register their attendance at the classes.') }}</p>

      <div class="col">
        <h3>{{ _('Files Availables:') }}</h3>
        <div class="list-group list-group-numbered mt-3 mb-4">
            {% for filename in pdf_files %}
            <a class="list-group-item list-group-item-action"  href="/download_pdf/{{ filename }}">{{ filename }}</a>
            {% endfor %}
        </div>
    
        <!-- Botón para generar PDFs -->

        {% if session['role'] == 'Owner' or session['role'] == 'Admin' %}
        <div class="row">
            <div class="col-sm-12 col-lg-4 mb-2">
                <form class="d-grid gap-2" action="/generate_week_pdfs" method="POST">
                    <button 
                        class="btn btn-success btn-block"  
                        data-toggle="tooltip" 
                        title="Crea PDF para cada clase en la semana actual"
                        type="submit" 
                        {% if not has_main_classes %} disabled {% endif %}>
                        <i class="bi bi-calendar2-week"></i>  {{ _('Generate PDFs for Week') }}
                    </button>
                </form>
            </div>
            
            <div class="col-sm-12 col-lg-4 mb-2">
                <form class="d-grid gap-2" action="/generate_all_pdfs" method="POST">
                    <button 
                        class="btn btn-primary btn-block" 
                        data-toggle="tooltip" 
                        title="Crea PDF para todas las clases" 
                        type="submit" 
                        {% if not has_classes %} disabled {% endif %}>
                        <i class="bi bi-collection"></i>  {{ _('Generate all PDFs') }}
                    </button>
                </form>
            </div>
            <div class="col-sm-12 col-lg-4 mb-2">
                <form 
    class="d-grid gap-2" 
    id="extra-class-form" 
    action="/generate_extra_pdfs" 
    method="POST">
    <input type="hidden" name="date" id="extra-class-date"> <!-- Campo oculto para la fecha -->
    <button 
        class="btn btn-secondary btn-block" 
        id="generate-extra-pdfs-btn"
        data-toggle="tooltip" 
        title="Crea PDF para todas las clases Extra" 
        type="button" 
        {% if not has_extra_classes %} disabled {% endif %}>
        <i class="bi bi-file-earmark"></i>  {{ _('Generate Extra class PDFs') }}
    </button>
</form>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const generateButton = document.getElementById('generate-extra-pdfs-btn');
        const extraClassForm = document.getElementById('extra-class-form');
        const dateInput = document.getElementById('extra-class-date');
    
        generateButton.addEventListener('click', async (event) => {
            event.preventDefault(); // Evitar el envío automático del formulario
    
            // Mostrar SweetAlert2 para seleccionar la fecha
            const { value: selectedDate } = await Swal.fire({
                title: 'Selecciona una fecha para las clases Extra',
                input: 'date',
                inputAttributes: {
                    min: new Date().toISOString().split('T')[0] // Fechas desde hoy en adelante
                },
                showCancelButton: true,
                confirmButtonText: 'Confirmar',
                cancelButtonText: 'Cancelar',
                inputValidator: (value) => {
                    if (!value) {
                        return '¡Debes seleccionar una fecha!';
                    }
                }
            });
    
            if (selectedDate) {
                // Guardar la fecha en el campo oculto del formulario y enviarlo
                dateInput.value = selectedDate;
                extraClassForm.submit();
            } else {
                // Mostrar mensaje de cancelación
                Swal.fire('Acción cancelada', 'No se generaron los códigos QR', 'info');
            }
        });
    });
    </script>
    
            </div>
        </div>
        {% endif %}

    </div>
            
{% endblock %}
