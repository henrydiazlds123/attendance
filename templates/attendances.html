{% extends "layout.html" %}
{% block title %}Attendance | List{% endblock %}
{% block head %}
<script>
    // Función para enviar el formulario al cambiar el valor de un select
    function submitForm() {
        document.getElementById('filterForm').submit();
    }
    function clearFilters() {
        // Eliminar todos los parámetros de la URL (filtros)
        window.location.href = "{{ url_for('routes.attendances') }}";
    }
    

</script>
{% endblock %}
{% block content %}
<div class="blog-post">
  <h2 class="blog-post-title"><i class="fa fa-check-square-o" aria-hidden="true"></i>  Class Attendance Records</h2>
  <div class="twoColumns">
    <p class="mb-3">
        
The table shows the attendance recorded each Sunday by members attending classes. 
Use the information in this list to Record each person's Attendance in the Tools application.
    </p>
</div>
{% if session['role'] == 'Owner' %}
  
{% endif %}
  {% if session['role'] == 'Admin' or session['role'] == 'Owner' %}
  <form class="form-inline d-flex justify-content-between mb-2" id="verificationForm" method="POST" action="/attendances">
      <a class="btn btn-primary" href="{{ url_for('routes.create_attendance') }}"><i class="fa fa-plus" aria-hidden="true"></i>  Add New Attendance</a>
      <div class="form-inline">
        <label class="my-1 mr-2" for="code_verification">Request new QR code? </label>
        <select class="custom-select my-1 mr-sm-2" name="code_verification" id="code_verification"  data-toggle="tooltip" title="Al activar la Verificacion de Domingo, solo se podrá usar la imagen de QR Code impresa para esa semana."onchange="submitVerificationForm()">
            <option value="true" {% if verification_enabled =='true' %}selected{% endif %}>Yes</option>
            <option value="false" {% if verification_enabled=='false' %}selected{% endif %}>No</option>
        </select>   
      </div>
    </form>
    {% endif %}
    <div class="mb-5">
      <form id="filterForm" method="GET" action="/attendances" class="card mb-3 p-3 bg-light">
          {% include 'partials/form_filter.html' %}
      </form>
      <!-- Actions Form -->
      <form method="POST" action="/attendances" class="pb-2">
        <table class="table table-striped table-sm">
          <thead class="thead-dark">
            <tr>
              <th scope="col">#</th>
              <th scope="col">Member</th>
              <th scope="col">Class</th>
              <th scope="col">Date</th>
              {% if session['role'] == 'Owner' %}
              <th scope="col">Unit</th>
              <th scope="col">Code</th>
              {% endif %}
              {% if session['role'] == 'Admin' or session['role'] == 'Owner' %}
              <th scope="col">Submited</th>
              {% endif %}
              {% if session['role'] == 'Owner' or session['role'] == 'Admin' %}
              <th scope="col">Actions</th>
              {% endif %}
              
            </tr>
          </thead>
          <tbody>
          {% for attendance in attendances %}
            <tr>
              <td scope="row">{{ loop.index }}</td>
              <td style="text-transform:capitalize">{{attendance.student_name}}</td>
              <td>{{attendance.short_name}}</td>
              <td>{{attendance.sunday_date.strftime("%b %d")}}</td>
              {% if session['role'] == 'Owner' %}
              <td>{{attendance.meeting_short_name}}</td>
              <td>{{attendance.sunday_code}}</td>              
              {% endif %}
              {% if session['role'] == 'Admin' or session['role'] == 'Owner' %}
                <td>{{attendance.submit_date.strftime("%b %d, %I:%M %p")}}</td>
                <td>
                    <a type="button" class="btn btn-primary btn-sm" href="{{ url_for('routes.update_attendance', id=attendance.id, **request.args.to_dict()) }}"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>

             {% endif %}
                {% if session['role'] == 'Owner' %}
                <form id="deleteForm-attendance-{{ attendance.id }}" action="{{ url_for('routes.delete_attendance', id=attendance.id, **request.args.to_dict()) }}" method="post" style="display:inline;">
                  <button type="button" class="btn btn-danger btn-sm" data-toggle="tooltip" title="Eliminar asistencia" onclick="confirmDelete('attendance', {{ attendance.id }})">
                    <i class="fa fa-trash-o fa-fw"></i>
                  </button>
                </form>
                  <!-- <a  data-toggle="tooltip" title="Elimina esta asistencia de {{ attendance.student_name }}" href="{{ url_for('routes.delete_attendance', id=attendance.id, **request.args.to_dict()) }}"><i class="fa fa-trash-o fa-fw"></i></a> -->
                {% endif %}
              
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </form>
      {% if session['role'] == 'Owner' %}
        <form id="deleteAllForm" method="POST" action="/attendances" class="mb-5">
            <input type="hidden" name="delete_all" value="true">
            <button id="delete_all" class="btn btn-danger mb-5" type="button" data-toggle="tooltip" title="Borra todos los registros de asistencia en la base de datos"{% if not has_records %}disabled{%
                endif %}>
                {% if not has_records %}
                Sin asistencia para mostrar
                {% else %}
                <i class="fa fa-eraser" aria-hidden="true"></i> Borrar todos los Registros
                {% endif %}
            </button>
        </form>
      {% endif %}
      <script>
        function submitVerificationForm() {
            document.getElementById('verificationForm').submit();
        }
    </script>
{% endblock %}