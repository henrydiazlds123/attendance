{% extends "layout.html" %}
{% block title %}Attendance | Manual{% endblock %}

{% block content %}
    <p class="mt-2">Use esta página para agregar su asistencia a la clase que figura a continuación.</p>
    <p>Una vez que envíe su asistencia y reciba una confirmación, podrá cerrar la aplicación.</p>
    <h3 id="classNameDisplay" class="mb-3 text-center"></h3>
    <form id="attendanceForm" method="POST" action="{{ url_for('routes.registrar') }}">
        <div class="input-group mb-3">
            <input type="text" class="form-control" id="studentName" name="studentName" placeholder="Nombre y Apellido"
                aria-label="Ingresa un Nombre y un Apellido" aria-describedby="button-addon2" required
                oninput="validateStudentName(this)">
                <button class="btn btn-success" type="submit" id="button-addon2">Enviar</button>
        </div>
                
        <input type="hidden" id="className" name="className">
        <input type="hidden" id="date" name="date">
        <!-- <input type="hidden" id="sundayCode" name="sunday_code"> -->
        <input type="hidden" id="sunday_code" name="sunday_code">
        <input type="hidden" id="unitNumber" name="unitNumber">

    </form>
    <script>
        document.getElementById('attendanceForm').addEventListener('submit', function (event) {
            const input = document.getElementById('studentName');
            input.value = input.value.trim();  // Elimina espacios iniciales y finales
            const regex = /^[^\s]+ [^\s]+$/;   // Asegura un solo espacio entre nombre y apellido

            if (!regex.test(input.value)) {
                event.preventDefault();  // Previene el envío del formulario
                Swal.fire({
                    icon: 'error',
                    title: 'Formato Incorrecto',
                    text: 'Por favor, ingrese solo un nombre y un apellido, separados por un espacio.',
                    confirmButtonText: 'OK'
                });
            }
        });

        // Configuración para mostrar y establecer la clase
        const urlParams = new URLSearchParams(window.location.search);
        const className = urlParams.get('class');
        const sundayCode = urlParams.get('code');
        const unitNumber = urlParams.get('unit');

        if (className) {
            document.getElementById('classNameDisplay').textContent = `Clase: ${decodeURIComponent(className)}`;
            document.getElementById('className').value = decodeURIComponent(className);
            document.getElementById('sunday_code').value = sundayCode;
            document.getElementById('unitNumber').value = unitNumber;
        } else {
            document.getElementById('classNameDisplay').textContent = 'Clase no especificada';
        }

        document.getElementById('date').value = new Date().toISOString().split('T')[0];
    </script>
{% endblock %}